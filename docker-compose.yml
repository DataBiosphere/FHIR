version: '3.8'
services:
  fhir:
    image: fhir
    build:
      context: ./fhir
      dockerfile: Dockerfile-dev
    volumes:
      - ./fhir/src:/usr/src/app/src
    ports:
      - 3000:3000
    environment:
      - TCGA_URL=http://tcga:3001
      - ANVIL_URL=http://anvil:3002
      - URL=http://localhost:3000/4_0_0

  tcga:
    image: tcga
    build:
      context: ./tcga
      dockerfile: Dockerfile-dev
    volumes:
      - ./tcga/src:/usr/src/app/src
    ports:
      - 3001:3001
    environment:
      - PORT=3001
  anvil-mongo:
    image: mongo
    environment:
      - PUID=1000
      - PGID=1000
    volumes:
      - ./anvil-mongodb/database:/data/db
    ports:
      - 27017:27017
    restart: unless-stopped

  anvil:
    image: anvil
    build:
      context: ./anvil-api
      dockerfile: Dockerfile-dev
    volumes:
      - ./anvil-api/src:/usr/src/app/src
    ports:
      - 3002:3002
    environment:
      - PORT=3002
      - MONGO_CONNECTION_STRING=mongodb://anvil-mongo:27017
